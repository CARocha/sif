{%extends "base.html"%}

{%block extra_js%}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript">
     $(document).ready(function () {
      var latlng = new google.maps.LatLng(12.877, -85.001);
      var options = {
        zoom: 8,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.TERRAIN
      }
      var map = new google.maps.Map(document.getElementById("map"), options);
      var image = '/files/img/mapicon.png';
      //var infowindow;

            $.getJSON('/ver/todo/', function(data){
                $.each(data, function(i, elemento){
                    var latlng = new google.maps.LatLng(elemento.lat, elemento.lon);
                    var marker = new google.maps.Marker({
                        position: latlng,
                        map: map,
                        name: elemento.nombre,
                        desc: elemento.propiedad,
                        icon: image                        
                    });
                    google.maps.event.addListener(marker, "click", function() {
                        var html = '<b>' + unescape(elemento.nombre) + '</b><br>' + unescape(elemento.propiedad) + '<br>';
                       infowindow = new google.maps.InfoWindow({
                                    content: html});
                  infowindow.open(map, this);
                  });                     
                });
            });
            /* Initialise datatables */
             var oTable = $('#example').dataTable();
        $('#tabladatos').hide();
        $('#vermapa').click(function(){
            $('#tabladatos').fadeOut();
            $('#map').fadeIn();
            $('#vermapa').addClass('active');
            $('#vertabla').removeClass('active');
        });
        $('#vertabla').click(function(){
            $('#map').fadeOut();
            $('#tabladatos').fadeIn();
            $('#vertabla').addClass('active');
            $('#vermapa').removeClass('active');

        });
    }); //fin del initialize

</script>

{%endblock%}

{%block contenido%}
<div class="interna">
    <div class="container_12">
        <br>
        <div class="grid_2">
            <img class="fotoactor" src="/files/img/duenobosque.jpg">
        </div>
        <div class="grid_10 despactor">
            <div class="titulo-actor">Dueños de bosque</div>
            <p>
                Personas naturales o jurídicas  que tienen dominio y posesión de una superficie de tierra, la que se encuentra total o parcialmente cubierta de bosques naturales o plantados, y pueden estar sometidos a un régimen de manejo forestal sostenible. La propiedad de la tierra del bosque puede ser individual, colectiva asociativa, y de comunidades indígenas y no indígenas.
            </p>
        </div>
        <div class="clear"></div>
        <div class="grid_12">
            <form action="." method="POST">
              {% csrf_token %}
                <div class="generalform">
                    <div class="formelement">
                        <div class="labelform">{{form.fecha.label}}</div>
                        <div class="filtros">{{form.fecha}}<br>{{form.fecha.errors}}</div>
                    </div>
                    <div class="formelement">
                        <div class="labelform">{{form.tipo_propiedad.label}}</div>
                        <div class="filtros">{{form.tipo_propiedad}}<br>{{form.tipo_propiedad.errors}}</div>
                    </div>
                    <!-- <div class="label">{{form.area_total.label}}</div>
                    <div class="filtros">{{form.area_total}}<br>{{form.area_total.errors}}</div>
                    <div class="clean"></div> -->
                    <div class="formelement">
                        <div class="labelform">{{form.organizado.label}}</div>
                        <div class="filtros">{{form.organizado}}<br>{{form.organizado.errors}}</div>
                    </div>

                    <div class="formelement">
                        <div class="labelform">{{form.gti.label}}</div>
                        <div class="filtros">{{form.gti}}<br>{{form.gti.errors}}</div>
                    </div>

                    <div class="formelement">
                        <div class="labelform">{{form.tipo_bosque_umf.label}}</div>
                        <div class="filtros">{{form.tipo_bosque_umf}}<br>{{form.tipo_bosque_umf.errors}}</div>
                    </div>

                    <div class="formelement">
                        <div class="labelform">{{form.certificacion.label}}</div>
                        <div class="filtros">{{form.certificacion}}<br>{{form.certificacion.errors}}</div>
                    </div>

                    <button class="consultar btn btn-warning"><i class="icon-refresh icon-white"></i> Actualizar Mapa</button>
                    <div class="clear"></div>
                </div>
            </form>
        </div>
        <div class="grid_12">
            <div class="maptabs">
                <div class="btn-group">
                <a href="#" id="vermapa"class="btn  btn-large active"><i class="icon-globe"></i>  Ver Mapa</a>
                <a href="#" id="vertabla"class="btn  btn-large"><i class="icon-list-alt"></i>  Ver lista de Datos</a>
                </div>
            </div>
            <div class="alert alert-success conteo"><b>45</b> Dueños de Bosques encontrados</div>
            <div class="clear"></div>
            <div id="map" style="width: 100%; height: 500px"></div>
            <div id="tabladatos">
                <table cellpadding="0" cellspacing="0" border="0" class="display" id="example">
                    <thead>
                        <tr>
                            <th>Nombre Propietario</th>
                            <th>Sexo</th>
                            <th>Area total (ha)</th>
                            <th>Departamento</th>
                            <th>Municipio</th>
                            <th>Tipo bosque UMF</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for obj in lista %}
                        <tr class="gradeA">
                            <td><a href="/ficha/{{obj.6}}">{{obj.0}}</a></td>
                            <td>{{obj.1}}</td>
                            <td>{{obj.2}}</td>
                            <td>{{obj.3}}</td>
                            <td>{{obj.4}}</td>
                            <td>{%for b in obj.5.all%}
                                {{b}},
                                {%endfor%}
                            </td> 
                        </tr>
                        {% endfor %}    
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>Nombre Propietario</th>
                            <th>Sexo</th>
                            <th>Area total (ha)</th>
                            <th>Departamento</th>
                            <th>Municipio</th>
                            <th>Tipo bosque UMF</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
{%endblock%}